---
title: (신)나이스페이먼츠
description: (신)나이스페이먼츠 연동가이드를 확인합니다.
---

import * as prose from "~/components/prose";
export const components = prose;

import Tabs from "~/components/gitbook/tabs/Tabs.astro";
import Tab from "~/components/gitbook/tabs/Tab.astro";

### (신)나이스페이먼츠 PG 설정하기

- [**(신)나이스페이먼츠 설정**](../../../ready/2-pg/payment-gateway/nice-v2) 페이지의 내용을 참고하여 PG 설정을 진행합니다.

### 가능한 결제수단

- **일반 결제**
  - `payMethod`파라미터를 결제수단에 따라 아래와 같이 설정해야 합니다.
    - 신용카드 : `CARD`
    - 실시간 계좌이체 : `TRANSFER`
    - 가상계좌 : `VIRTUAL_ACCOUNT`
    - 휴대폰 소액결제 : `MOBILE`
    - 상품권결제: `GIFT_CERTIFICATE`
    - 간편 결제 : `EASY_PAY`
- **API 수기(키인) 결제**
  - `payment_method_option`파라미터를 `card`로 설정해야 합니다.
- **API 빌링키 발급**
  - `payment_method_option`파라미터를 `card`로 설정해야 합니다.

### SDK 결제 요청하기

결제 요청 시에는 `requestPayment` 함수를 호출해야 합니다.
`channelKey`파라미터에 결제 채널 연동 시 생성된 채널 키값을 지정하여 (신)나이스페이먼츠 연동임을 명시해주세요.

(신)나이스페이먼츠 기준으로 작성한 예시 코드는 아래와 같습니다.

<Tabs>
  <Tab title="SDK 결제 요청">
    ```javascript
    import * as PortOne from '@portone/browser-sdk/v2';
    function requestPayment() {
      PortOne.requestPayment({
        storeId: 'store-4ff4af41-85e3-4559-8eb8-0d08a2c6ceec', // 가맹점 storeId로 변경해주세요.
        paymentId: 'paymentId_{now()}',
        orderName: '나이키 와플 트레이너 2 SD',
        totalAmount: 1000,
        currency: 'CURRENCY_KRW',
        channelKey: 'channel-key-9987cb87-6458-4888-b94e-68d9a2da896d', // 콘솔 결제 연동 화면에서 채널 연동 시 생성된 채널 키를 입력해주세요.
        payMethod: 'CARD'
      });
    }
    ```

  </Tab>
</Tabs>

#### 주요 파라미터

- `storeId` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 가맹점의 상점을 식별하는 고유한 값입니다.
- `paymentId` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 가맹점이 채번하는 주문 고유 번호로 매번 고유하게 채번되어야 합니다.
- `orderName` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 주문명으로 가맹점에서 자유롭게 입력합니다.
- `channelKey` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 콘솔 결제 연동 화면에서 채널 연동 시 생성된 채널 키로 호출하고자 하는 채널을 지정합니다.
- `totalAmount` <mark style="color:red;">**\***</mark> <mark style="color:purple;">**number**</mark>
- 결제 금액으로 결제를 원하는 통화(currency)별 scale factor(소수점 몇번째 자리까지 유효한지)를 고려한 number 형식만 허용됩니다.
- `currency` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 결제통화로 원화 결제를 원할 시 `KRW`로 입력해야 합니다. (신)나이스페이먼츠의 경우 `KRW`와 `USD`를 지원합니다.
- `payMethod` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 결제수단을 구분하는 코드로 원하는 결제수단 값을 입력해야 합니다.
- `taxFreeAmount` <mark style="color:purple;">**number**</mark>
- 면세 금액으로 (신)나이스페이먼츠과 상점아이디 계약시 지정금액 혹은 복합과세 방식으로 계약한 경우 면세 처리를 위해 면세금액을 반드시 입력해야 합니다.
면세금액 미 입력 시 면세금액은 0원으로 자동 처리되며, 결제 요청 금액은 모두 과세 처리 되오니 이 점 유의하시기 바랍니다.

### API 수기(키인)결제 요청하기

수기(키인)로 결제하기 위해서는 `POST /payments/${PAYMENT_ID_HERE}/instant/pay`를 이용하여 결제 요청을 해야합니다.

<Tabs>
  <Tab title="API 수기(키인) 결제 요청">
    ```javascript
    // ... 수기(키인) 결제
    const issueResponse = await axios({
      url: `https://api.portone.io/v2/payments/${PAYMENT_ID_HERE}/instant/pay`,
      method: "post",
      headers: { "Authorization": "Bearer " + access_token },
      data: {
        channel_key: 'channel-key-9987cb87-6458-4888-b94e-68d9a2da896d', // 콘솔 결제 연동 화면에서 채널 연동 시 생성된 채널 키를 입력해주세요.
        order_name: '나이키 와플 트레이너 2 SD',
        total_amount: 10000,
        currency: 'KRW',
        customer: {
          customer_name: {
            first_name: '길동',
            last_name: '홍'
          },
          email: 'test@test.com',
          phone_number: '01012345678'
        },
        payment_method_option: {
          card: {
            card_credential: {
              card_number: '1111111111111111',
              expiry_month: '01',
              expiry_year: '20',
              birth_or_business_registration_number: '900101',
              password_two_digits: '00'
            },
            card_installment_plan: 3, // 카드 할부 개월수
            use_free_interest_from_mall: true, // 가맹점 분담 무이자 설정
            use_card_point: true, // 카드 포인트 사용 설정
          },
        },
      }
    });
    ```
  </Tab>

</Tabs>

#### 주요 파라미터

- `payment_id` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 가맹점이 채번하는 주문 고유 번호로 매번 고유하게 채번되어야 하며, URL path에 포함돼야 합니다.
- `channel_key` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 콘솔 결제 연동 화면에서 채널 연동 시 생성된 채널 키로 호출하고자 하는 채널을 지정합니다.
- `order_name` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 주문명으로 가맹점에서 자유롭게 입력합니다.
- `total_amount` <mark style="color:red;">**\***</mark> <mark style="color:purple;">**number**</mark>
- 결제 금액으로 결제를 원하는 통화(currency)별 scale factor(소수점 몇번째 자리까지 유효한지)를 고려한 number 형식만 허용됩니다.
- `currency` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
- 결제통화로 원화 결제를 원할 시 `KRW`로 입력해야 합니다.
- `taxFreeAmount` <mark style="color:purple;">**number**</mark>
- 면세 금액으로 (신)나이스페이먼츠과 상점아이디 계약시 지정금액 혹은 복합과세 방식으로 계약한 경우 면세 처리를 위해 면세금액을 반드시 입력해야 합니다.
면세금액 미 입력 시 면세금액은 0원으로 자동 처리되며, 결제 요청 금액은 모두 과세 처리 되오니 이 점 유의하시기 바랍니다.
- `payment_method_option` <mark style="color:red;">**\***</mark> <mark style="color:blue;">**object**</mark>
- 결제 수단에 대한 정보를 담고있는 객체입니다.
  - `card` <mark style="color:red;">**\***</mark> <mark style="color:blue;">**object**</mark>
    - `card_credential` <mark style="color:red;">**\***</mark> <mark style="color:blue;">**object**</mark>
      - `card_number` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
      - 카드번호로 10자리 이상 20자리 이하의 숫자만 입력해야 합니다.
      - `expiry_month` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
      - 카드 유효기간의 월로 2자리 숫자만 입력해야 합니다.
      - `expiry_year` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
      - 카드 유효기간의 년도로 2자리 숫자만 입력해야 합니다.
      - `birth_or_business_registration_number` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
      - 카드 소지자의 생년월일 혹은 사업자 등록번호로 6자리 숫자만 입력해야 합니다.
      - `password_two_digits` <mark style="color:red;">**\***</mark> <mark style="color:green;">**string**</mark>
      - 카드 비밀번호 앞 2자리로 2자리 숫자만 입력해야 합니다.
    - `card_installment_plan` <mark style="color:purple;">**number**</mark>
    - 카드 할부 개월수로 0(일시불) 혹은 2~12개월까지의 숫자만 입력해야 합니다.
    - `use_free_interest_from_mall` <mark style="color:orange;">**boolean**</mark>
    - 가맹점 부담 무이자 설정으로 `true` 혹은 `false`만 입력
    - `use_card_point` <mark style="color:orange;">**boolean**</mark>
    - 카드 포인트 사용 설정으로 `true` 혹은 `false`만 입력

### API 빌링키 발급 및 예약/반복 결제 요청하기
빌링키를 발급하기 위해서는 `POST /billing-keys`를 이용하여 빌링키 발급 요청을 해야합니다. 이후 발급된 빌링키로 예약/반복 결제를 하기위해 `POST /schedules` 를 이용하여 결제를 예약합니다.

<Tabs>
  <Tab title="API 빌링키 발급 요청">
    ```javascript
    const issueResponse = await axios({
      url: "https://api.portone.io/v2/billing-keys",
      method: "post",
      headers: { "Authorization": "Bearer " + access_token },
      data: {
        channel_key: 'channel-key-9987cb87-6458-4888-b94e-68d9a2da896d', // 콘솔 결제 연동 화면에서 채널 연동 시 생성된 채널 키를 입력해주세요.
        customer: {
          customer_id: 'customer-1234', // 가맹점에서 관리하는 고객 고유번호
        },
        payment_method_option: {
          card: {
            card_credential: {
              card_number: '1111111111111111',
              expiry_month: '01',
              expiry_year: '20',
              birth_or_business_registration_number: '900101',
              password_two_digits: '00'
            },
          },
        },
      }
    });
    ```
  </Tab>

  <Tab title="API 예약/반복 결제">

    ```javascript
    const response = await axios({
      url: `https://api.portone.io/v2/schedules`,
      method: "post",
      headers: { Authorization: "Bearer " + access_token },
      data: {
        payment_id: 'payment-id-1', // 결제 고유 번호
        billing_key: 'billing-key-1', // 빌링키 발급 API를 통해 발급받은 빌링키
        order_name: "월간 이용권 정기결제",
        customer: {
          customer_id: 'customer-1234', // 가맹점에서 관리하는 고객 고유번호
        },
        total_amount: 8900,
        currency: "KRW",
        scheduled_at: "2023-08-24T14:15:22Z", // 결제를 시도할 시각
        use_free_interest_from_mall: true, // 가맹점 분담 무이자 설정
        card_installment_plan: 3, // 카드 할부 개월수
        use_card_point: true, // 카드 포인트 사용 설정
      },
    });
    ```

  </Tab>

</Tabs>

### (신)나이스페이먼츠과 사전 계약이 필요한 경우

아래 기능을 사용하시려면 나이스페이먼츠에 사전 신청 후 계약이 완료되어야 합니다.
그렇지 않은 상태에서 해당 기능 이용시 PG창 호출에 실패하거나, 승인에 실패하거나, 승인에 성공하더라도 의도한 바와는 다른 응답을 얻게 될 수 있으니 주의 해주시기 바랍니다.

- 모든 결제 수단(간편결제 포함)
- 면세 / 복합과세 사용
- 부가세 지정 금액 방식 사용(영세율 포함)
- 부분 취소
- 할부 사용
- 상점 부담 무이자 할부 사용
- 카드사 포인트 사용
- 에스크로 사용
- 해외 결제 사용
- 일부 bypass 파라미터
  - UserCI
  - MallUserID
  - DirectCouponYN
  - PaycoClientId, PaycoAccessToken
  - SamPayMallType
